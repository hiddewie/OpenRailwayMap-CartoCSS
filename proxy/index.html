<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="apple-touch-icon" sizes="180x180" href="image/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="image/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="image/favicon-16x16.png">

  <link rel="stylesheet" href="css/bootstrap-4.0.0.css">
  <link rel="stylesheet" href="css/maplibre-gl-3.6.css">
  <style>
      html,
      body {
          padding: 0;
          margin: 0;
      }

      #map-container {
          width: 100vw;
          height: 100vh;
      }
      #map {
          position: relative;
          width: 100%;
          height: 100%;
      }

      .search-container {
          position: absolute;
          z-index: 100;
          padding: .5rem;
          padding-right: 3rem;
          background: transparent;
          width: 400px;
      }
      .search-container input[type=search] {
          padding: 6px;
          font-family: sans-serif;
          width: 14rem;
      }
      .search-container .input-group-append {
          background-color: white;
      }
      #search-results {
          display: none;
          background-color: white;
          padding: .3rem 0;
          max-height: 300px;
          overflow-y: auto;
          border-bottom-left-radius: 2px;
          border-bottom-right-radius: 2px;
          box-shadow: 0 0 0 2px rgba(0,0,0,.1);
      }
      #search-results .result {
          border-bottom: 1px solid #eee;
          padding: 0 .5rem;
          cursor: pointer;
      }
      #search-results .result:nth-child(2n) {
          background: #f8f8f8;
      }
      #search-results .result:hover, #search-results .result:nth-child(2n):hover {
          background: #eee;
      }
      .search-container .search-icon {
          position: absolute;
          top: 12px;
          right: 14px;
          z-index: 30;
          cursor: pointer;
      }
      .search-container #cancel-icon {
          display: none;
      }
  </style>
  <title>OpenRailwayMap</title>
</head>

<body>
<div id="map-container">
  <div class="search-container">
    <div class="input-group">
      <input type="search" id="search" class="form-control" placeholder="Search..." autocomplete="no">
      <svg role="presentation" onclick="searchFor(search.value)" id="search-icon" class='search-icon' viewBox="0 0 32 32" width="14" height="14" fill="none" stroke="#57ae00" stroke-linecap="round" stroke-linejoin="round" stroke-width="4">
        <circle cx="14" cy="14" r="12" />
        <path d="M23 23 L30 30" />
      </svg>
      <svg role="presentation" onclick="hideSearchResults()" id="cancel-icon" class="search-icon" viewBox="0 0 32 32" width="14" height="14" fill="none" stroke="#ae0000" stroke-linecap="round" stroke-linejoin="round" stroke-width="3">
        <path d="M4 4 L28 28" />
        <path d="M4 28 L28 4" />
      </svg>
    </div>
    <div id="search-results"></div>
  </div>
  <div id="map"></div>
</div>

<script src="js/maplibre-gl-3.6.js"></script>
<script>
  const search = document.getElementById('search');
  const searchResults = document.getElementById('search-results');
  const searchIcon = document.getElementById('search-icon');
  const cancelIcon = document.getElementById('cancel-icon');
  function searchFor(term) {
    if (!term || term.length < 3) {
      hideSearchResults();
    } else {
      // or ref=...
      fetch(`https://api.openrailwaymap.org/v2/facility?name=${term}`)
        .then(result => result.json())
        .then(result => {
          console.info('result', result, result.body)
          showSearchResults(result)
        })
        .catch(error => {
          hideSearchResults();
          console.error(error);
        });
    }
  }
  function showSearchResults(results) {
    let content = '';
    if (results.length === 0) {
      content += `<div class="result" onclick="hideSearchResults()"><i>No results</i></div>`
    } else {
      results.forEach(result => {
        content += `<div class="result" onclick="hideSearchResults(); map.panTo([${result.latitude}, ${result.longitude}])">${result.name}</div>`
      })
    }
    searchResults.innerHTML = content;
    searchResults.style.display = 'block';
    cancelIcon.style.display = 'block';
    searchIcon.style.display = 'none';
  }
  function hideSearchResults() {
    searchResults.style.display = 'none';
    cancelIcon.style.display = 'none';
    searchIcon.style.display = 'block';
  }

  search.addEventListener('keydown', event => {
    if (event.key === 'Enter') {
      searchFor(event.target.value);
    }
  });
</script>
<script>
  const railwayLineWidth = ['step', ['zoom'],
    ['case',
      ['all',
        ['==', ['get', 'railway'], 'rail'],
        ['all', ['==', ['get', 'usage'], 'main'], ['==', ['get', 'service'], null]],
      ], 1.5,
      0,
    ],
    6,
    ['case',
      ['all',
        ['==', ['get', 'railway'], 'rail'],
        ['all', ['==', ['get', 'usage'], 'main'], ['==', ['get', 'service'], null]],
      ], 2.5,
      0,
    ],
    8,
    ['case',
      ['all',
        ['==', ['get', 'railway'], 'rail'],
        ['any',
          ['all', ['==', ['get', 'usage'], 'main'], ['==', ['get', 'service'], null]],
          ['all', ['==', ['get', 'usage'], 'branch'], ['==', ['get', 'service'], null]],
        ]
      ], 1.5,
      0,
    ],
    9,
    ['case',
      ['all',
        ['==', ['get', 'railway'], 'rail'],
        ['any',
          ['all', ['==', ['get', 'usage'], 'main'], ['==', ['get', 'service'], null]],
          ['all', ['==', ['get', 'usage'], 'branch'], ['==', ['get', 'service'], null]],
        ]
      ], 3.5,
      ['all',
        ['==', ['get', 'railway'], 'construction'],
        ['==', ['get', 'construction_railway'], 'rail'],
        ['any', ['==', ['get', 'usage'], 'main'], ['==', ['get', 'usage'], 'branch']],
        ['==', ['get', 'service'], null],
      ],
      ['case',
        ['!=', ['get', 'service'], null], 1.5,
        3,
      ],
      0,
    ],
    10,
    ['case',
      ['all',
        ['==', ['get', 'railway'], 'rail'],
        ['any',
          ['all', ['==', ['get', 'usage'], 'main'], ['==', ['get', 'service'], null]],
          ['all', ['==', ['get', 'usage'], 'branch'], ['==', ['get', 'service'], null]],
          ['all', ['==', ['get', 'usage'], 'industrial'], ['==', ['get', 'service'], null]],
        ]
      ],
      ['case',
        ['all', ['==', ['get', 'usage'], 'industrial'], ['==', ['get', 'service'], null]], 2,
        3.5,
      ],
      ['all',
        ['==', ['get', 'railway'], 'narrow_gauge'],
        ['==', ['get', 'service'], null],
      ],
      ['case',
        ['any', ['==', ['get', 'usage'], 'industrial'], ['==', ['get', 'service'], null]], 2,
        3,
      ],
      ['any',
        ['all',
          ['==', ['get', 'railway'], 'construction'],
          ['==', ['get', 'construction_railway'], 'rail'],
          ['any', ['==', ['get', 'usage'], 'main'], ['==', ['get', 'usage'], 'branch']],
          ['==', ['get', 'service'], null],
        ],
        ['all',
          ['==', ['get', 'railway'], 'construction'],
          ['any',
            ['==', ['get', 'construction_railway'], 'subway'],
            ['==', ['get', 'construction_railway'], 'light_rail'],
          ],
          ['==', ['get', 'service'], null],
        ],
        ['all',
          ['any',
            ['==', ['get', 'railway'], 'subway'],
            ['==', ['get', 'railway'], 'light_rail'],
          ],
          ['==', ['get', 'service'], null],
        ],
      ],
      ['case',
        ['!=', ['get', 'service'], null], 1.5,
        3,
      ],
      0,
    ],
    11,
    ['case',
      ['all',
        ['==', ['get', 'railway'], 'rail'],
        ['any',
          ['all', ['==', ['get', 'usage'], 'main'], ['==', ['get', 'service'], null]],
          ['all', ['==', ['get', 'usage'], 'branch'], ['==', ['get', 'service'], null]],
          ['==', ['get', 'usage'], 'industrial'],
          ['all', ['==', ['get', 'usage'], null], ['==', ['get', 'service'], 'siding']],
          ['all', ['==', ['get', 'usage'], null], ['==', ['get', 'service'], 'crossover']],
          ['all', ['==', ['get', 'usage'], null], ['==', ['get', 'service'], 'spur']],
        ]
      ],
      ['case',
        ['any',
          ['all', ['==', ['get', 'usage'], 'industrial'], ['==', ['get', 'service'], null]],
          ['all', ['==', ['get', 'usage'], null], ['==', ['get', 'service'], 'siding']],
          ['all', ['==', ['get', 'usage'], null], ['==', ['get', 'service'], 'crossover']],
        ], 2,
        ['any',
          ['all', ['==', ['get', 'usage'], 'industrial'], ['!=', ['get', 'service'], null]],
          ['all', ['==', ['get', 'usage'], null], ['==', ['get', 'service'], 'spur']],
        ], 1.5,
        3.5,
      ],
      ['all',
        ['==', ['get', 'railway'], 'narrow_gauge'],
        ['any',
          ['==', ['get', 'service'], null],
          ['==', ['get', 'service'], 'spur'],
          ['==', ['get', 'service'], 'siding'],
          ['==', ['get', 'service'], 'crossover'],
        ],
      ],
      ['case',
        ['any', ['==', ['get', 'usage'], 'industrial'], ['==', ['get', 'service'], null]], 2,
        3,
      ],
      ['any',
        ['all',
          ['==', ['get', 'railway'], 'construction'],
          ['==', ['get', 'construction_railway'], 'rail'],
          ['any', ['==', ['get', 'usage'], 'main'], ['==', ['get', 'usage'], 'branch']],
          ['==', ['get', 'service'], null],
        ],
        ['all',
          ['==', ['get', 'railway'], 'construction'],
          ['any',
            ['==', ['get', 'construction_railway'], 'subway'],
            ['==', ['get', 'construction_railway'], 'light_rail'],
            ['==', ['get', 'construction_railway'], 'tram'],
          ],
          ['==', ['get', 'service'], null],
        ],
        ['all',
          ['any',
            ['==', ['get', 'railway'], 'subway'],
            ['==', ['get', 'railway'], 'light_rail'],
            ['==', ['get', 'railway'], 'tram'],
          ],
          ['==', ['get', 'service'], null],
        ],
      ],
      ['case',
        ['!=', ['get', 'service'], null], 1.5,
        3,
      ],
      0,
    ],
    12,
    ['case',
      ['all',
        ['==', ['get', 'railway'], 'rail'],
        ['any',
          ['all', ['==', ['get', 'usage'], 'main'], ['==', ['get', 'service'], null]],
          ['all', ['==', ['get', 'usage'], 'branch'], ['==', ['get', 'service'], null]],
          ['==', ['get', 'usage'], 'industrial'],
          ['all', ['==', ['get', 'usage'], null], ['==', ['get', 'service'], 'siding']],
          ['all', ['==', ['get', 'usage'], null], ['==', ['get', 'service'], 'crossover']],
          ['all', ['==', ['get', 'usage'], null], ['==', ['get', 'service'], 'spur']],
          ['all', ['==', ['get', 'usage'], null], ['==', ['get', 'service'], 'yard']],
        ]
      ],
      ['case',
        ['any',
          ['all', ['==', ['get', 'usage'], 'industrial'], ['==', ['get', 'service'], null]],
          ['all', ['==', ['get', 'usage'], null], ['==', ['get', 'service'], 'siding']],
          ['all', ['==', ['get', 'usage'], null], ['==', ['get', 'service'], 'crossover']],
        ], 2,
        ['any',
          ['all', ['==', ['get', 'usage'], 'industrial'], ['!=', ['get', 'service'], null]],
          ['all', ['==', ['get', 'usage'], null], ['==', ['get', 'service'], 'spur']],
          ['all', ['==', ['get', 'usage'], null], ['==', ['get', 'service'], 'yard']],
        ], 1.5,
        3.5,
      ],
      ['all',
        ['==', ['get', 'railway'], 'narrow_gauge'],
        ['any',
          ['==', ['get', 'service'], null],
          ['==', ['get', 'service'], 'spur'],
          ['==', ['get', 'service'], 'siding'],
          ['==', ['get', 'service'], 'crossover'],
          ['==', ['get', 'service'], 'yard'],
        ],
      ],
      ['case',
        ['any', ['==', ['get', 'usage'], 'industrial'], ['==', ['get', 'service'], null]], 2,
        3,
      ],
      ['any',
        ['all',
          ['==', ['get', 'railway'], 'construction'],
          ['==', ['get', 'construction_railway'], 'rail'],
          ['any', ['==', ['get', 'usage'], 'main'], ['==', ['get', 'usage'], 'branch']],
          ['==', ['get', 'service'], null],
        ],
        ['all',
          ['==', ['get', 'railway'], 'construction'],
          ['any',
            ['==', ['get', 'construction_railway'], 'subway'],
            ['==', ['get', 'construction_railway'], 'light_rail'],
            ['==', ['get', 'construction_railway'], 'tram'],
          ],
          ['==', ['get', 'service'], null],
        ],
        ['all',
          ['any',
            ['==', ['get', 'railway'], 'subway'],
            ['==', ['get', 'railway'], 'light_rail'],
            ['==', ['get', 'railway'], 'tram'],
          ],
          ['==', ['get', 'service'], null],
        ],
      ],
      ['case',
        ['!=', ['get', 'service'], null], 1.5,
        3,
      ],
      0,
    ],
    13,
    ['case',
      ['all',
        ['==', ['get', 'railway'], 'rail'],
        ['any',
          ['all', ['==', ['get', 'usage'], 'main'], ['==', ['get', 'service'], null]],
          ['all', ['==', ['get', 'usage'], 'branch'], ['==', ['get', 'service'], null]],
          ['==', ['get', 'usage'], 'industrial'],
          ['all', ['==', ['get', 'usage'], null], ['==', ['get', 'service'], 'siding']],
          ['all', ['==', ['get', 'usage'], null], ['==', ['get', 'service'], 'crossover']],
          ['all', ['==', ['get', 'usage'], null], ['==', ['get', 'service'], 'spur']],
          ['all', ['==', ['get', 'usage'], null], ['==', ['get', 'service'], 'yard']],
          ['all', ['==', ['get', 'usage'], null], ['==', ['get', 'service'], null]],
        ]
      ],
      ['case',
        ['any',
          ['all', ['==', ['get', 'usage'], 'industrial'], ['==', ['get', 'service'], null]],
          ['all', ['==', ['get', 'usage'], null], ['==', ['get', 'service'], 'siding']],
          ['all', ['==', ['get', 'usage'], null], ['==', ['get', 'service'], 'crossover']],
          ['all', ['==', ['get', 'usage'], null], ['==', ['get', 'service'], null]],
        ], 2,
        ['any',
          ['all', ['==', ['get', 'usage'], 'industrial'], ['!=', ['get', 'service'], null]],
          ['all', ['==', ['get', 'usage'], null], ['==', ['get', 'service'], 'spur']],
          ['all', ['==', ['get', 'usage'], null], ['==', ['get', 'service'], 'yard']],
        ], 1.5,
        3.5,
      ],
      ['all',
        ['==', ['get', 'railway'], 'narrow_gauge'],
        ['any',
          ['==', ['get', 'service'], null],
          ['==', ['get', 'service'], 'spur'],
          ['==', ['get', 'service'], 'siding'],
          ['==', ['get', 'service'], 'crossover'],
          ['==', ['get', 'service'], 'yard'],
        ],
      ],
      ['case',
        ['any', ['==', ['get', 'usage'], 'industrial'], ['==', ['get', 'service'], null]], 2,
        3,
      ],
      ['any',
        ['all',
          ['==', ['get', 'railway'], 'construction'],
          ['==', ['get', 'construction_railway'], 'rail'],
          ['any', ['==', ['get', 'usage'], 'main'], ['==', ['get', 'usage'], 'branch']],
          ['==', ['get', 'service'], null],
        ],
        ['all',
          ['==', ['get', 'railway'], 'construction'],
          ['any',
            ['==', ['get', 'construction_railway'], 'subway'],
            ['==', ['get', 'construction_railway'], 'light_rail'],
            ['==', ['get', 'construction_railway'], 'tram'],
            ['==', ['get', 'construction_railway'], 'narrow_gauge'],
          ],
          ['==', ['get', 'service'], null],
        ],
        ['any',
          ['==', ['get', 'railway'], 'subway'],
          ['==', ['get', 'railway'], 'light_rail'],
          ['==', ['get', 'railway'], 'tram'],
        ],
      ],
      ['case',
        ['!=', ['get', 'service'], null], 1.5,
        3,
      ],
      0,
    ],
  ];
  const casingPaint = dashArray => ({
    'line-color': 'white',
    'line-width': railwayLineWidth,
    'line-gap-width': 2,
    'line-dasharray': dashArray,
  });
  const casingLayout = {
    'line-sort-key': ['get', 'rank'],
    'line-join': 'round',
  };
  const fillPaint = dashArray => ({
    'line-color': ['match', ['get', 'train_protection'],
      'zsi127', '#884400',
      'ptc', '#cc0033',
      'construction_etcs', '#87CEFA',
      'etcs', 'blue',
      'tvm', '#009966',
      'kvb', '#66cc33',
      'asfa', '#ff9092',
      'scmt', '#dd11ff',
      'atc', '#6600cc',
      'atb', '#ff8c00',
      'lzb', 'red',
      'pzb', '#ffb900',
      'other', 'black',
      'grey',
    ],
    'line-width': railwayLineWidth,
    'line-dasharray': dashArray,
  });

  const main_color = '#ff8100';
  const highspeed_color = '#ff0c00';
  const branch_color = '#c4b600';
  const narrow_gauge_color = '#c0da00';
  const no_usage_color = '#000000';
  const disused_color = '#70584d';
  const abandoned_color = '#7f6a62';
  const razed_color = '#94847e';
  const tram_color = '#d877b8';
  const subway_color = '#0300c3';
  const light_rail_color = '#00bd14';
  const siding_color = '#000000';
  const yard_color = '#000000';
  const spur_color = '#87491d';
  const industrial_color = '#87491d';

  const railway_casing_color = '#ffffff';
  const bridge_casing_color = '#000000';
  const tunnel_color = '#979797';

  const turntable_fill = '#ababab';
  const turntable_casing = '#808080';
  const turntable_casing_width = 2;

  const railway_casing_add = 1;

  /* additional width of the casing of dashed lines */
  const railway_tunnel_casing_add = 1;
  const bridge_casing_add = 4;

  const abandoned_dasharray = [5, 5];
  const razed_dasharray = [3, 7];
  const construction_dasharray = [9, 9];
  const proposed_dasharray = [2, 8];

  const standardFillPaint = dashArray => ({
    // TODO handle construction and proposed: color and dasharray
    'line-color': ['case',
      ['==', ['get', 'railway'], 'rail'],
      ['case',
        ['all', ['==', ['get', 'usage'], null], ['==', ['get', 'service'], 'spur']], spur_color,
        ['all', ['==', ['get', 'usage'], null], ['==', ['get', 'service'], 'yard']], yard_color,
        ['all', ['==', ['get', 'usage'], null], ['==', ['get', 'service'], 'crossover']], siding_color,
        ['all', ['==', ['get', 'usage'], null], ['==', ['get', 'service'], 'siding']], siding_color,
        ['all', ['==', ['get', 'usage'], null], ['==', ['get', 'service'], null]], no_usage_color,
        ['==', ['get', 'usage'], 'industrial'], industrial_color,
        ['==', ['get', 'usage'], 'branch'], branch_color,
        ['all', ['==', ['get', 'usage'], 'main'], ['==', ['get', 'highspeed'], 'yes']], highspeed_color,
        ['==', ['get', 'usage'], 'main'], main_color,
        'rgba(255, 255, 255, 1.0)',
      ],
      ['==', ['get', 'railway'], 'narrow_gauge'],
      ['case',
        ['all', ['==', ['get', 'usage'], 'industrial'], ['==', ['get', 'service'], 'spur']], industrial_color,
        narrow_gauge_color,
      ],
      ['==', ['get', 'railway'], 'disused'], disused_color,
      ['==', ['get', 'railway'], 'abandoned'], abandoned_color,
      ['==', ['get', 'railway'], 'razed'], razed_color,
      ['==', ['get', 'railway'], 'subway'], subway_color,
      ['==', ['get', 'railway'], 'light_rail'], light_rail_color,
      ['==', ['get', 'railway'], 'tram'], tram_color,
      'rgba(255, 255, 255, 1.0)',
    ],
    'line-width': railwayLineWidth,
    'line-dasharray': dashArray,
  });

  const style = {
    center: [12.55, 51.14], // default
    zoom: 3.75, // default
    glyphs: `${location.origin}/font/{fontstack}/{range}`,
    metadata: {},
    name: 'OpenRailwayMap',
    sources: {
      openstreetmap: {
        type: 'raster',
        tiles: [
          'https://tile.openstreetmap.org/{z}/{x}/{y}.png',
        ],
        tileSize: 256,
        attribution: '<a href="https://www.openstreetmap.org/about" target="_blank">&copy; OpenStreetMap contributors</a>'
      },
      openrailwaymap: {
        type: 'vector',
        // url: `${location.origin}/tiles`,
        url: `${location.origin}/railway_tunnel,railway_line_casing,railway_line_low,railway_line_med,railway_turntables,railway_line_fill,railway_bridge,railway_text_stations_med,railway_text_stations_high,railway_symbols,railway_text_med,railway_text_high,railway_text_km_med,railway_text_km_high,railway_switch_ref,railway_text_detail`,
        // url: `${location.origin}/railway_bridge,railway_line_casing,railway_line_fill,railway_line_low,railway_line_med,railway_switch_ref,railway_symbols,railway_text_detail,railway_text_high,railway_text_km_high,railway_text_km_med,railway_text_med,railway_text_stations_med,railway_tunnel,railway_turntables`,
        attribution: '<a href="https://github.com/hiddewie/OpenRailwayMap-vector" target="_blank">&copy; OpenRailwayMap contributors</a>'
      },
    },
    sprite: [
      {
        id: 'general',
        url: `${location.origin}/sprite/general`,
      },
      {
        id: 'at',
        url: `${location.origin}/sprite/at`,
      },
      {
        id: 'de',
        url: `${location.origin}/sprite/de`,
      },
      {
        id: 'fi',
        url: `${location.origin}/sprite/fi`,
      },
      {
        id: 'nl',
        url: `${location.origin}/sprite/nl`,
      },
      {
        id: 'flex',
        url: `${location.origin}/sprite/flex`,
      },
    ],
    version: 8,
    layers: [
      {
        id: 'background',
        type: 'background',
        paint: {
          'background-color': 'rgb(242, 243, 240)'
        }
      },

      // --- Background: OpenStreetMap ---
      {
        id: "openstreetmap",
        type: "raster",
        source: "openstreetmap",
        paint: {
          'raster-saturation': -1.0, // or 0.0 for colorful
        }
      },

      // --- Style: Standard ---
      {
        id: 'railway_bridge_railing',
        type: 'line',
        minzoom: 9,
        source: 'openrailwaymap',
        'source-layer': 'railway_bridge',
        paint: {
          'line-color': bridge_casing_color,
          'line-width': railwayLineWidth,
          'line-gap-width': bridge_casing_add,
        }
      },
      {
        id: 'railway_tunnel_casing',
        type: 'line',
        minzoom: 9,
        source: 'openrailwaymap',
        'source-layer': 'railway_tunnel',
        layout: {
          'line-join': 'round',
        },
        paint: {
          'line-color': railway_casing_color,
          'line-width': railwayLineWidth,
          'line-gap-width': railway_tunnel_casing_add,
        }
      },
      {
        id: 'railway_line_casing',
        type: 'line',
        minzoom: 9,
        source: 'openrailwaymap',
        'source-layer': 'railway_line_casing',
        layout: {
          'line-join': 'round',
        },
        paint: {
          'line-color': railway_casing_color,
          'line-width': railwayLineWidth,
          'line-gap-width': railway_casing_add,
        }
      },
      {
        id: 'railway_line_low_casing',
        type: 'line',
        minzoom: 7,
        source: 'openrailwaymap',
        'source-layer': 'railway_line_low',
        layout: {
          'line-join': 'round',
        },
        paint: {
          'line-color': railway_casing_color,
          'line-width': railwayLineWidth,
          'line-gap-width': railway_casing_add,
        }
      },
      {
        id: 'railway_line_med_casing',
        type: 'line',
        minzoom: 8,
        maxzoom: 9,
        source: 'openrailwaymap',
        'source-layer': 'railway_line_med',
        layout: {
          'line-join': 'round',
        },
        paint: {
          'line-color': railway_casing_color,
          'line-width': railwayLineWidth,
          'line-gap-width': railway_casing_add,
        }
      },
      {
        id: 'railway_bridge_casing',
        type: 'line',
        minzoom: 9,
        source: 'openrailwaymap',
        'source-layer': 'railway_bridge',
        layout: {
          'line-join': 'round',
        },
        paint: {
          'line-color': railway_casing_color,
          'line-width': railwayLineWidth,
          'line-gap-width': railway_casing_add,
        }
      },
      {
        id: 'railway_line_fill',
        type: 'line',
        minzoom: 9,
        source: 'openrailwaymap',
        'source-layer': 'railway_line_fill',
        layout: {
          'line-join': 'round',
        },
        paint: standardFillPaint([1]),
      },
      {
        id: 'railway_line_low_fill',
        type: 'line',
        minzoom: 7,
        source: 'openrailwaymap',
        'source-layer': 'railway_line_low',
        layout: {
          'line-join': 'round',
        },
        paint: standardFillPaint([1]),
      },
      {
        id: 'railway_line_med_fill',
        type: 'line',
        minzoom: 8,
        maxzoom: 9,
        source: 'openrailwaymap',
        'source-layer': 'railway_line_med',
        layout: {
          'line-join': 'round',
        },
        paint: standardFillPaint([1]),
      },
      {
        id: 'railway_tunnel_fill',
        type: 'line',
        minzoom: 9,
        source: 'openrailwaymap',
        'source-layer': 'railway_tunnel',
        layout: {
          'line-join': 'round',
        },
        paint: standardFillPaint([1]),
      },
      // TODO blending: https://github.com/maplibre/maplibre-gl-js/issues/48
      // {
      //   id: 'railway_tunnel_bright',
      //   type: 'line',
      //   minzoom: 9,
      //   source: 'openrailwaymap',
      //   'source-layer': 'railway_tunnel',
      //   layout: {
      //     'line-join': 'round',
      //   },
      //   paint: {
      //     'line-color': railway_casing_color,
      //     'line-width': 2, // TODO zoom and tag dependent
      //     'line-gap-width': railway_casing_add,
      //   }
      // },
      {
        id: 'railway_bridge_fill',
        type: 'line',
        minzoom: 9,
        source: 'openrailwaymap',
        'source-layer': 'railway_bridge',
        layout: {
          'line-join': 'round',
        },
        paint: standardFillPaint([1]),
      },
      {
        id: 'railway_turntables_fill',
        type: 'fill',
        minzoom: 11,
        source: 'openrailwaymap',
        'source-layer': 'railway_turntables',
        paint: {
          'fill-color': turntable_fill,
        }
      },
      {
        id: 'railway_turntables_casing',
        type: 'line',
        minzoom: 16,
        source: 'openrailwaymap',
        'source-layer': 'railway_turntables',
        paint: {
          'line-color': turntable_casing,
          'line-width': turntable_casing_width,
        }
      },
      {
        id: 'railway_text_stations_med',
        type: 'symbol',
        minzoom: 6,
        maxzoom: 11,
        source: 'openrailwaymap',
        'source-layer': 'railway_text_stations_med',
        // TODO filter
        paint: {
          'text-color': ['case',
            ['==', ['get', 'railway'], 'yard'], '#87491D',
            ['==', ['get', 'railway'], 'tram_stop'], '#D877B8',
            ['==', ['get', 'railway'], 'station'], 'blue',
            ['==', ['get', 'railway'], 'halt'], 'blue',
            '#616161',
          ],
          'text-halo-color': ['case',
            ['==', ['get', 'railway'], 'yard'], '#F1F1F1',
            ['==', ['get', 'railway'], 'tram_stop'], 'white',
            ['==', ['get', 'railway'], 'station'], 'white',
            ['==', ['get', 'railway'], 'halt'], 'white',
            '#F1F1F1',
          ],
          'text-halo-width': 1.5,
        },
        layout: {
          'text-field': '{label}',
          // TODO light rail / subway oblique font
          'text-font': ['Noto Sans Bold'],
          'text-size': 11,
          'text-padding': 10,
          'text-max-width': 5,
          'text-offset': ['case',
            ['==', ['get', 'railway'], 'tram_stop'], ['literal', [0, 9]],
            ['literal', [0, 0]]
          ],
        },
      },
      {
        id: 'railway_text_stations_high',
        type: 'symbol',
        minzoom: 11,
        source: 'openrailwaymap',
        'source-layer': 'railway_text_stations_med',
        // TODO filter
        paint: {
          'text-color': ['case',
            ['==', ['get', 'railway'], 'yard'], '#87491D',
            ['==', ['get', 'railway'], 'tram_stop'], '#D877B8',
            ['==', ['get', 'railway'], 'station'], 'blue',
            ['==', ['get', 'railway'], 'halt'], 'blue',
            '#616161',
          ],
          'text-halo-color': ['case',
            ['==', ['get', 'railway'], 'yard'], '#F1F1F1',
            ['==', ['get', 'railway'], 'tram_stop'], 'white',
            ['==', ['get', 'railway'], 'station'], 'white',
            ['==', ['get', 'railway'], 'halt'], 'white',
            '#F1F1F1',
          ],
          'text-halo-width': 1.5,
        },
        layout: {
          'text-field': '{label}',
          // TODO light rail / subway oblique font
          'text-font': ['Noto Sans Bold'],
          'text-size': 11,
          'text-padding': 10,
          'text-max-width': 5,
          'text-offset': ['case',
            ['==', ['get', 'railway'], 'tram_stop'], ['literal', [0, 9]],
            ['literal', [0, 0]]
          ],
        },
      },
      {
        id: 'railway_symbols',
        type: 'symbol',
        minzoom: 11,
        source: 'openrailwaymap',
        'source-layer': 'railway_symbols',
        layout: {
          // ['image', ['get', 'feature']]
          // TODO: fix size of feature icons
          'icon-image': ['case',
            ['==', ['get', 'railway'], 'level_crossing'], 'general:level-crossing',
            ['==', ['get', 'railway'], 'crossing'], 'general:crossing',
            ['==', ['get', 'railway'], 'tram_stop'], 'general:tram-stop',
            ['==', ['get', 'railway'], 'border'], 'general:border',
            ['==', ['get', 'railway'], 'owner_change'], 'general:border',
            ['==', ['get', 'railway'], 'phone'], 'general:phone',
            ['==', ['get', 'railway'], 'radio'], ['case',
              ['==', ['get', 'man_made'], 'mast'], 'general:radio-mast',
              ['==', ['get', 'man_made'], 'tower'], 'general:radio-mast',
              ['==', ['get', 'man_made'], 'antenna'], 'general:radio-antenna',
              '',
            ],
            '',
          ],
        }
      },
      {
        id: 'railway_text_med',
        type: 'symbol',
        minzoom: 8,
        maxzoom: 15,
        source: 'openrailwaymap',
        'source-layer': 'railway_text_med',
        // TODO filter
        paint: {
          'text-color': '#585858',
          'text-halo-color': 'white',
          'text-halo-width': 1,
        },
        layout: {
          'symbol-placement': 'line',
          'text-field': '{label}',
          'text-font': ['Noto Sans Bold'],
          'text-size': 11,
          'text-padding': 10,
          'text-max-width': 5,
          'symbol-spacing': 200,
        },
      },
      {
        id: 'railway_text_high',
        type: 'symbol',
        minzoom: 15,
        maxzoom: 17,
        source: 'openrailwaymap',
        'source-layer': 'railway_text_high',
        // TODO filter
        paint: {
          'text-color': '#585858',
          'text-halo-color': 'white',
          'text-halo-width': 1,
        },
        layout: {
          'symbol-placement': 'line',
          'text-field': '{label}',
          'text-font': ['Noto Sans Bold'],
          'text-size': 11,
          'text-padding': 10,
          'text-max-width': 5,
          'symbol-spacing': 200,
        },
      },
      {
        id: 'railway_text_km_med',
        type: 'symbol',
        minzoom: 11,
        maxzoom: 14,
        source: 'openrailwaymap',
        'source-layer': 'railway_text_km_med',
        paint: {
          'text-color': 'black',
          'text-halo-color': 'white',
          'text-halo-width': 1,
        },
        layout: {
          'text-field': '{pos}',
          'text-font': ['Noto Sans Bold'],
          'text-size': 11,
        },
      },
      {
        id: 'railway_text_km_high',
        type: 'symbol',
        minzoom: 14,
        source: 'openrailwaymap',
        'source-layer': 'railway_text_km_high',
        paint: {
          'text-color': 'black',
          'text-halo-color': 'white',
          'text-halo-width': 1,
        },
        layout: {
          'text-field': '{pos}',
          'text-font': ['Noto Sans Bold'],
          'text-size': 11,
        },
      },
      {
        id: 'railway_switch_ref',
        type: 'symbol',
        minzoom: 16,
        source: 'openrailwaymap',
        'source-layer': 'railway_switch_ref',
        paint: {
          'text-halo-color': ['case',
            ['==', ['get', 'railway_local_operated'], 'yes'], 'yellow',
            'white'
          ],
          'text-halo-width': 2,
        },
        layout: {
          'text-field': '{ref}',
          'text-font': ['Noto Sans Medium'],
          'text-size': 11,
          'text-padding': 20,
        },
      },
      {
        id: 'railway_text_detail_line_numbers',
        type: 'symbol',
        minzoom: 17,
        source: 'openrailwaymap',
        'source-layer': 'railway_text_detail',
        // TODO filter
        paint: {
          'text-color': '#585858',
          'text-halo-color': 'white',
          'text-halo-width': 1,
        },
        layout: {
          'symbol-placement': 'line',
          'text-field': '{label}',
          'text-font': ['Noto Sans Bold'],
          'text-size': 11,
          'text-padding': 10,
          'text-max-width': 5,
          'symbol-spacing': 200,
        },
      },
      {
        id: 'railway_text_detail_track_numbers',
        type: 'symbol',
        minzoom: 17,
        source: 'openrailwaymap',
        'source-layer': 'railway_text_detail',
        // filter: ['!=', ['get', 'track_ref'], null],
        paint: {
          'text-color': 'white',
          'text-halo-color': 'blue',
          'text-halo-width': 4,
          'text-halo-blur': 2,
        },
        layout: {
          'symbol-placement': 'line',
          'text-field': '{track_ref}',
          'text-font': ['Noto Sans Bold'],
          'text-size': 10,
          'text-padding': 10,
        },
      },


      // --- Style: Railway protection and signals ---

    //   {
    //     id: 'railway_line_low_casing',
    //     type: 'line',
    //     source: 'openrailwaymap',
    //     maxzoom: 8,
    //     'source-layer': 'railway_line',
    //     filter: ['all',
    //       ['==', ['get', 'railway'], 'rail'],
    //       ['==', ['get', 'usage'], 'main'],
    //       ['==', ['get', 'service'], null],
    //     ],
    //     paint: casingPaint([1]),
    //     layout: casingLayout,
    //   },
    //   {
    //     id: 'railway_line_med_casing',
    //     type: 'line',
    //     minzoom: 8,
    //     maxzoom: 9,
    //     source: 'openrailwaymap',
    //     'source-layer': 'railway_line',
    //     filter: ['all',
    //       ['==', ['get', 'railway'], 'rail'],
    //       ['any',
    //         ['==', ['get', 'usage'], 'main'],
    //         ['==', ['get', 'usage'], 'branch'],
    //       ],
    //       ['==', ['get', 'service'], null],
    //     ],
    //     paint: casingPaint([1]),
    //     layout: casingLayout,
    //   },
    //   {
    //     id: 'railway_line_casing_construction',
    //     type: 'line',
    //     source: 'openrailwaymap',
    //     minzoom: 9,
    //     'source-layer': 'railway_line',
    //     filter: ['==', ['get', 'railway'], 'construction'],
    //     paint: casingPaint([2, 2]),
    //     layout: casingLayout,
    //   },
    //   {
    //     id: 'railway_line_casing',
    //     type: 'line',
    //     source: 'openrailwaymap',
    //     minzoom: 9,
    //     'source-layer': 'railway_line',
    //     filter: ['!=', ['get', 'railway'], 'construction'],
    //     paint: casingPaint([1]),
    //     layout: casingLayout,
    //   },
    //   {
    //     id: 'railway_line_low_fill',
    //     type: 'line',
    //     source: 'openrailwaymap',
    //     maxzoom: 8,
    //     'source-layer': 'railway_line',
    //     filter: ['all',
    //       ['==', ['get', 'railway'], 'rail'],
    //       ['==', ['get', 'usage'], 'main'],
    //       ['==', ['get', 'service'], null],
    //     ],
    //     paint: fillPaint([1]),
    //     layout: casingLayout,
    //   },
    //   {
    //     id: 'railway_line_med_fill',
    //     type: 'line',
    //     minzoom: 8,
    //     maxzoom: 9,
    //     source: 'openrailwaymap',
    //     'source-layer': 'railway_line',
    //     filter: ['all',
    //       ['==', ['get', 'railway'], 'rail'],
    //       ['any',
    //         ['==', ['get', 'usage'], 'main'],
    //         ['==', ['get', 'usage'], 'branch'],
    //       ],
    //       ['==', ['get', 'service'], null],
    //     ],
    //     paint: fillPaint([1]),
    //     layout: casingLayout,
    //   },
    //   {
    //     id: 'railway_line_fill_construction',
    //     type: 'line',
    //     minzoom: 9,
    //     source: 'openrailwaymap',
    //     'source-layer': 'railway_line',
    //     filter: ['==', ['get', 'railway'], 'construction'],
    //     paint: fillPaint([2, 2]),
    //     layout: casingLayout,
    //   },
    //   {
    //     id: 'railway_line_fill',
    //     type: 'line',
    //     minzoom: 9,
    //     source: 'openrailwaymap',
    //     'source-layer': 'railway_line',
    //     filter: ['!=', ['get', 'railway'], 'construction'],
    //     paint: fillPaint([1]),
    //     layout: casingLayout,
    //   },
    //   {
    //     id: 'signal_boxes_point',
    //     type: 'circle',
    //     minzoom: 11,
    //     source: 'openrailwaymap',
    //     'source-layer': 'signal_boxes_point',
    //     paint: {
    //       'circle-color': '#008206',
    //       'circle-radius': ['step', ['zoom'],
    //         7,
    //         15, 12,
    //         17, 18,
    //       ],
    //       'circle-stroke-color': 'white',
    //       'circle-stroke-width': 1,
    //     },
    //   },
    //   {
    //     id: 'signal_boxes_polygon',
    //     type: 'fill',
    //     minzoom: 13,
    //     source: 'openrailwaymap',
    //     'source-layer': 'signal_boxes_polygon',
    //     paint: {
    //       'fill-color': '#008206',
    //       'fill-outline-color': 'white',
    //     },
    //   },
    //   {
    //     id: 'signal_boxes_polygon_outline',
    //     type: 'line',
    //     minzoom: 13,
    //     source: 'openrailwaymap',
    //     'source-layer': 'signal_boxes_polygon',
    //     paint: {
    //       'line-color': 'white',
    //       'line-width': 1,
    //     },
    //   },
    //   {
    //     id: 'railway_signals_base',
    //     type: 'circle',
    //     minzoom: 12,
    //     source: 'openrailwaymap',
    //     'source-layer': 'railway_signals',
    //     paint: {
    //       'circle-radius': 2.2,
    //     },
    //   },
    //   {
    //     id: 'railway_signals',
    //     type: 'symbol',
    //     minzoom: 14,
    //     source: 'openrailwaymap',
    //     'source-layer': 'railway_signals',
    //     paint: {
    //       // TODO https://github.com/maplibre/martin/issues/1075
    //       // 'icon-halo-color': 'rgba(255, 255, 255, 1)',
    //       // 'icon-halo-blur': 0,
    //       // 'icon-halo-width': 2.0,
    //
    //       'text-halo-color': 'white',
    //       'text-halo-width': 1.5,
    //       'text-halo-blur': 1,
    //     },
    //     layout: {
    //       'icon-overlap': 'always',
    //       'icon-image': ['image', ['get', 'feature']],
    //       'text-field': '{ref}',
    //       'text-font': ['Noto Sans Medium'],
    //       'text-size': 9,
    //       'text-anchor': 'top',
    //       'text-offset': ['case',
    //         ['==', ['get', 'main_height'], 'dwarf'], ['literal', [0, 1]],
    //         ['any',
    //           ['all',
    //             ['==', ['get', 'main_form'], 'light'],
    //             ['==', ['get', 'speed_limit_form'], 'light'],
    //           ],
    //           ['all',
    //             ['==', ['get', 'distant_form'], 'light'],
    //             ['==', ['get', 'speed_limit_form'], 'light'],
    //           ],
    //         ], ['literal', [0, 2]],
    //         ['literal', [0, 1.5]],
    //       ],
    //     }
    //   },
    //   {
    //     id: 'railway_signals_deactivated',
    //     type: 'symbol',
    //     minzoom: 14,
    //     source: 'openrailwaymap',
    //     'source-layer': 'railway_signals',
    //     filter: ['get', 'deactivated'],
    //     layout: {
    //       'icon-overlap': 'always',
    //       'icon-image': 'general:signal-deactivated',
    //     }
    //   },
    //   {
    //     id: 'signal_boxes_text_medium',
    //     type: 'symbol',
    //     minzoom: 13,
    //     maxzoom: 16,
    //     source: 'openrailwaymap',
    //     'source-layer': 'signal_boxes_text',
    //     paint: {
    //       'text-color': '#404040',
    //       'text-halo-color': '#bfffb3',
    //       'text-halo-width': 1.5,
    //     },
    //     layout: {
    //       'text-field': '{ref}',
    //       'text-font': ['Noto Sans Bold'],
    //       'text-size': 11,
    //     }
    //   },
    //   {
    //     id: 'signal_boxes_text_high',
    //     type: 'symbol',
    //     minzoom: 16,
    //     source: 'openrailwaymap',
    //     'source-layer': 'signal_boxes_text',
    //     paint: {
    //       'text-color': '#404040',
    //       'text-halo-color': '#bfffb3',
    //       'text-halo-width': 1.5,
    //     },
    //     layout: {
    //       'text-field': '{name}',
    //       'text-font': ['Noto Sans Bold'],
    //       'text-size': 11,
    //     }
    //   },
    ],
  };

  const map = new maplibregl.Map({
    container: 'map',
    style,
    hash: true,
    maxZoom: 18,
    minPitch: 0,
    maxPitch: 0,
  });

  map.on('load', () => {
    map.addControl(new maplibregl.NavigationControl({
      showCompass: false,
      visualizePitch: false,
    }));
    map.addControl(
      new maplibregl.GeolocateControl({
        positionOptions: {
          enableHighAccuracy: true
        },
        trackUserLocation: true,
        showAccuracyCircle: false,
        showUserLocation: true,
      })
    );
    map.addControl(new maplibregl.FullscreenControl());
    map.addControl(new maplibregl.ScaleControl({
      maxWidth: 150,
      unit: 'metric',
    }), 'bottom-right');
  })
</script>
</body>

</html>
